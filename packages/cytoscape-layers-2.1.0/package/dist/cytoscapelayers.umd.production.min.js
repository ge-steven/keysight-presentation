!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).CytoscapeLayers={})}(this,(function(t){"use strict";const e={position:"absolute",left:"0",top:"0",userSelect:"none",outlineStyle:"none",width:"100%",height:"100%"};function s(t){t.stopPropagation()}function i(t){t.addEventListener("click",s),t.addEventListener("mousedown",s),t.addEventListener("mouseup",s),t.addEventListener("mousemove",s)}class o{constructor(t){this.adapter=t,this.updateOnRenderEnabled=!1}inVisibleBounds(t){return this.adapter.inVisibleBounds(t)}get updateOnRender(){return this.updateOnRenderEnabled}set updateOnRender(t){this.updateOnRenderEnabled!==t&&(this.updateOnRenderEnabled=t,t?this.cy.on("render",this.update):this.cy.off("render",void 0,this.update))}get cy(){return this.adapter.cy}moveUp(){this.adapter.move(this,-1)}moveDown(){this.adapter.move(this,1)}moveBack(){this.adapter.move(this,Number.NEGATIVE_INFINITY)}moveFront(){this.adapter.move(this,Number.POSITIVE_INFINITY)}insertBefore(t,e){return this.adapter.insert("before",this,t,e)}insertAfter(t,e){return this.adapter.insert("after",this,t,e)}}class n extends o{constructor(t,s){super(t),this.callbacks=[],this.update=()=>{for(const t of this.callbacks)t(this.node)},this.root=s,Object.assign(this.root.style,e)}get visible(){return"none"!==this.root.style.display}set visible(t){this.visible!=t&&(this.root.style.display=t?"":"none")}show(){this.visible=!0}hide(){this.visible=!1}callback(t){return this.callbacks.push(t),this.update(),this}resize(){}remove(){this.root.remove()}}const r="http://www.w3.org/2000/svg";class a extends n{constructor(t,e,s={}){super(t,e.createElementNS(r,"svg")),this.type="svg",this.updateOnTransform=!1,this.root.__cy_layer=this,this.node=e.createElementNS(r,"g"),this.node.__cy_layer=this,this.root.appendChild(this.node),s.stopClicks&&i(this.node)}setViewport(t,e,s){this.node.setAttribute("transform",`translate(${t},${e})scale(${s})`),this.updateOnTransform&&this.update()}}class c extends n{constructor(t,e,s={}){super(t,e.createElementNS(r,"svg")),this.type="svg-static",this.root.__cy_layer=this,this.node=e.createElementNS(r,"g"),this.node.__cy_layer=this,this.root.appendChild(this.node),s.stopClicks&&i(this.node)}setViewport(){}}class h extends o{constructor(t,s,o={}){var n,r,a;super(t),this.callbacks=[],this.transform={tx:0,ty:0,zoom:1},this.update=()=>this.draw(),this.node=s.createElement("canvas"),Object.assign(this.node.style,e),o.stopClicks&&i(this.node),this.pixelRatio=null!==(n=null!==(r=o.pixelRatio)&&void 0!==r?r:(null!==(a=window)&&void 0!==a?a:{}).devicePixelRatio)&&void 0!==n?n:1,this.ctx=this.node.getContext("2d",o),this.ctx.resetTransform()}get visible(){return"none"!==this.node.style.display}set visible(t){this.node.style.display=t?"":"none"}show(){this.visible=!0}hide(){this.visible=!1}get root(){return this.node}callback(t){return this.callbacks.push(t),this.update(),this}clear(){const t=this.ctx,e=t.getTransform();t.resetTransform(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.setTransform(e)}draw(){this.clear(),this.ctx.save(),this.ctx.resetTransform(),this.ctx.scale(this.pixelRatio,this.pixelRatio),this.ctx.translate(this.transform.tx,this.transform.ty),this.ctx.scale(this.transform.zoom,this.transform.zoom);for(const t of this.callbacks)t(this.ctx);this.ctx.restore()}resize(t,e){this.node.width=t*this.pixelRatio,this.node.height=e*this.pixelRatio,this.update()}setViewport(t,e,s){}remove(){this.node.remove()}}class d extends h{constructor(t,e,s={}){super(t,e,s),this.type="canvas",this.node.__cy_layer=this}setViewport(t,e,s){this.transform.tx=t,this.transform.ty=e,this.transform.zoom=s,this.update()}}class l extends h{constructor(t,e,s={}){super(t,e,s),this.type="canvas-static",this.node.__cy_layer=this}}class u extends n{constructor(t,e,s={}){super(t,e.createElement("div")),this.type="html",this.updateOnTransform=!1,this.root.__cy_layer=this,this.node=e.createElement("div"),this.node.__cy_layer=this,this.node.style.position="absolute",this.node.style.left="0px",this.node.style.top="0px",this.root.appendChild(this.node),s.stopClicks&&i(this.node)}setViewport(t,e,s){this.node.style.transform=`translate(${t}px,${e}px)scale(${s})`,this.updateOnTransform&&this.update()}}class p extends n{constructor(t,e,s={}){super(t,e.createElement("div")),this.type="html-static",this.node.__cy_layer=this,s.stopClicks&&i(this.node)}get node(){return this.root}setViewport(){}}class y extends o{constructor(t,e){super(t),this.update=()=>{},this.node=e}get root(){return this.node}resize(){}setViewport(){}remove(){}}class m extends y{constructor(t,e){super(t,e),this.type="node",this.node.__cy_layer=this}}class f extends y{constructor(t,e){super(t,e),this.type="drag",this.node.__cy_layer=this}}class v extends y{constructor(t,e){super(t,e),this.type="select-box",this.node.__cy_layer=this}}function x(t,e,s){const i=Array.from(t.children);if(!s.uniqueElements){e.forEach(e=>{const o=s.bb(e);if(s.isVisible(o))if(i.length>0)s.update(i.shift(),e,o);else{const i=s.enter(e,o);t.appendChild(i),s.update(i,e,o)}});for(const t of i)t.remove();return}const o=new Map(i.map(t=>[t.dataset.id,t]));let n=-1;e.forEach(e=>{const r=s.bb(e);if(!s.isVisible(r))return;n++;const a=e.id(),c=i[n],h=o.get(a);let d;if(h){if(s.update(h,e,r),o.delete(a),c===h)return;d=h}else d=s.enter(e,r),d.dataset.id=a,s.update(d,e,r);0===n?t.insertAdjacentElement("afterbegin",d):i[n-1].insertAdjacentElement("afterend",d),i.splice(n,0,d)}),o.forEach(t=>t.remove())}function b(t,e){return t.callback(e),{remove:()=>{t.callbacks.splice(t.callbacks.indexOf(e),1)}}}function w(t){return{selector:":visible",updateOn:null!=t&&t.queryEachTime?"render":"position",queryEachTime:!1,checkBounds:!0}}function g(t,e,s){const i=Object.assign({checkBoundsPointCount:5,initCollection:()=>{}},w(s),s),o=i.queryEachTime?t.cy.collection():t.cy.edges(i.selector);i.queryEachTime||i.initCollection(o),"render"===i.updateOn?t.updateOnRender=!0:"position"===i.updateOn?(o.on("position add remove",t.update),o.sources().on("position",t.update),o.targets().on("position",t.update)):o.on("add remove",t.update);const n=b(t,s=>{const n=i.queryEachTime?t.cy.edges(i.selector):o;i.queryEachTime&&i.initCollection(n),n.forEach(o=>{const n=o._private.rscratch,r=n&&null!=n.startX&&null!=n.startY?{x:n.startX,y:n.startY}:o.sourceEndpoint(),a=n&&null!=n.endX&&null!=n.endY?{x:n.endX,y:n.endY}:o.targetEndpoint();if(i.checkBounds&&i.checkBoundsPointCount>0&&!function(t,e,s,i){const o=t=>({x:e.x*t+s.x*(1-t),y:e.y*t+s.y*(1-t)});if(1===i)return t.inVisibleBounds(o(.5));const n=1/i;for(let e=0;e<=i;e++)if(t.inVisibleBounds(o(e*n)))return!0;return!1}(t,r,a,i.checkBoundsPointCount))return;if(n&&n.pathCache)return void e(s,o,n.pathCache,r,a);const c=new Path2D;c.moveTo(r.x,r.y),c.lineTo(a.x,a.y),e(s,o,c,r,a)})});return{layer:t,edges:o,remove:()=>{o.off("position add remove",void 0,t.update),o.sources().off("position",void 0,t.update),o.targets().off("position",void 0,t.update),n.remove()}}}function E(t,e,s={}){const i=Object.assign({transform:"",position:"top-left",boundingBox:{includeLabels:!1,includeOverlays:!1},uniqueElements:!1,initCollection:()=>{}},w(s),s),o=i.queryEachTime?t.cy.collection():t.cy.nodes(i.selector);i.queryEachTime||i.initCollection(o),"render"===i.updateOn?t.updateOnRender=!0:o.on("position"===i.updateOn?"position add remove":"add remove",t.update);const n=e=>({layer:t,nodes:o,remove:()=>{o.off("position add remove",void 0,t.update),e.remove()}});if("canvas"===t.type){const s=i,r=n=>{const r=n.getTransform(),a=s.queryEachTime?t.cy.nodes(s.selector):o;i.queryEachTime&&i.initCollection(a),a.forEach(o=>{const a=o.boundingBox(i.boundingBox);if(!s.checkBounds||t.inVisibleBounds(a)){if("top-left"===s.position)n.translate(a.x1,a.y1);else if("center"===s.position){const t=o.position();n.translate(t.x,t.y)}e(n,o,a),"none"!==s.position&&n.setTransform(r)}})};return n(b(t,r))}const a=i,c={bb:t=>t.boundingBox(a.boundingBox),isVisible:a.checkBounds?e=>t.inVisibleBounds(e):()=>!0,uniqueElements:!0===a.uniqueElements};if(a.checkBounds&&(t.updateOnTransform=!0),"html"===t.type){const s={...c,enter:(e,s)=>{const i=t.node.ownerDocument.createElement("div");return i.style.position="absolute",a.init&&a.init(i,e,s),i},update:(t,s,i)=>{if("top-left"===a.position)t.style.transform=`${a.transform}translate(${i.x1}px,${i.y1}px)`;else if("center"===a.position){const e=s.position();t.style.transform=`${a.transform}translate(${e.x}px,${e.y}px)`}e(t,s,i)}},r=e=>{const n=a.queryEachTime?t.cy.nodes(a.selector):o;i.queryEachTime&&i.initCollection(n),x(e,n,s)};return n(b(t,r))}const h={...c,enter:(e,s)=>{const i=t.node.ownerDocument.createElementNS(r,"g");return a.init&&a.init(i,e,s),i},update:(t,s,i)=>{if("top-left"===a.position)t.setAttribute("transform",`${a.transform}translate(${i.x1},${i.y1})`);else if("center"===a.position){const e=s.position();t.setAttribute("transform",`${a.transform}translate(${e.x},${e.y})`)}e(t,s,i)}};return n(b(t,e=>{const s=a.queryEachTime?t.cy.nodes(a.selector):o;i.queryEachTime&&i.initCollection(s),x(e,s,h)}))}class _{constructor(t){this.resize=()=>{const t=this.cy.width(),e=this.cy.height();this.viewport.width=t,this.viewport.height=e;for(const s of this.layers)s.resize(t,e)},this.destroy=()=>{for(const t of this.layers)t.remove();this.cy.off("destroy",void 0,this.destroy),this.cy.off("viewport",void 0,this.zoomed),this.cy.off("resize",void 0,this.resize),this.cy.scratch("_layers",void 0)},this.zoomed=()=>{const t=this.cy.pan(),e=this.cy.zoom();this.viewport.tx=t.x,this.viewport.ty=t.y,this.viewport.zoom=e;for(const s of this.layers)s.setViewport(t.x,t.y,e)},this.renderPerEdge=g,this.renderPerNode=E,this.cy=t,this.adapter={cy:this.cy,insert:(t,e,s)=>this.insert(t,e,s),move:(t,e)=>this.move(t,e),inVisibleBounds:t=>{const e=this.viewport,s=t=>{const s=t*e.zoom+e.tx;return s>=0&&s<=e.width},i=t=>{const s=t*e.zoom+e.ty;return s>=0&&s<=e.height};return function(t){return null!=t.x}(t)?s(t.x)&&i(t.y):s(t.x1)&&i(t.y1)||s(t.x2)&&i(t.y1)||s(t.x2)&&i(t.y2)||s(t.x1)&&i(t.y2)||s((t.x1+t.x2)/2)&&i((t.y1+t.y2)/2)}};const e=t.container(),s=new m(this.adapter,e.querySelector('[data-id="layer2-node"]'));this.nodeLayer=s;const i=new f(this.adapter,e.querySelector('[data-id="layer1-drag"]'));this.dragLayer=i;const o=new v(this.adapter,e.querySelector('[data-id="layer0-selectbox"]'));this.selectBoxLayer=o,s.root.style.zIndex="",i.root.style.zIndex="",o.root.style.zIndex="",s.root.insertAdjacentElement("afterend",i.root),i.root.insertAdjacentElement("afterend",o.root),t.on("viewport",this.zoomed),t.on("resize",this.resize),t.on("destroy",this.destroy),this.viewport={width:this.cy.width(),height:this.cy.height(),tx:this.cy.pan().x,ty:this.cy.pan().y,zoom:this.cy.zoom()}}move(t,e){const s=this.layers,i=s.indexOf(t),o=Math.max(Math.min(i+e,s.length,0));o!==i&&(i>=s.length-1?this.root.appendChild(t.root):this.root.insertBefore(t.root,s[o].root))}get document(){return this.cy.container().ownerDocument}get root(){return this.nodeLayer.node.parentElement}get layers(){return Array.from(this.root.children).map(t=>t.__cy_layer).filter(t=>null!=t)}getLayers(){return this.layers}init(t){return t.resize(this.viewport.width,this.viewport.height),t.setViewport(this.viewport.tx,this.viewport.ty,this.viewport.zoom),t}update(){this.zoomed();for(const t of this.layers)t instanceof d&&t.draw()}createLayer(t,e){switch(t){case"svg":return this.init(new a(this.adapter,this.document,e));case"html":return this.init(new u(this.adapter,this.document,e));case"canvas":return this.init(new d(this.adapter,this.document,e));case"html-static":return this.init(new p(this.adapter,this.document,e));case"svg-static":return this.init(new c(this.adapter,this.document,e));case"canvas-static":return this.init(new l(this.adapter,this.document,e))}}append(t,e){const s=this.createLayer(t,e);return this.root.appendChild(s.root),s}insert(t,e,s,i){const o=this.createLayer(s,i);return e.root.insertAdjacentElement("before"===t?"beforebegin":"afterend",o.root),o}getLast(){var t;const e=this.layers;return null!==(t=e[e.length-1])&&void 0!==t?t:null}getFirst(){var t;return null!==(t=this.layers[0])&&void 0!==t?t:null}}function T(t=this){if(!t.container())throw new Error("layers plugin does not work in headless environments");const e=t.scratch("_layers");if(e)return e;const s=new _(t);return t.scratch("_layers",s),s}function z(t){t("core","layers",T)}void 0!==window.cytoscape&&z(window.cytoscape),t.LayersPlugin=_,t.default=z,t.layers=T,t.renderPerEdge=g,t.renderPerNode=E,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=cytoscapelayers.umd.production.min.js.map
